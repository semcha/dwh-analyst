# Проделанные шаги

```bash
# Установка dbt & dbt-clickhouse
pip install dbt==0.21.0 dbt-clickhouse==0.21.0

# Инициализация dbt проекта
dbt init clickhouse_starschema

# Установка Clickhouse
sudo apt-get install apt-transport-https ca-certificates dirmngr
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E0C56BD4
echo "deb https://repo.clickhouse.com/deb/stable/ main/" | sudo tee \
    /etc/apt/sources.list.d/clickhouse.list
sudo apt-get update
sudo apt-get install -y clickhouse-server clickhouse-client
sudo service clickhouse-server start
```

Создание профиля `profiles.yml` в папке `~./dbt/`

```yaml
clickhouse_starschema:
  target: dev
  outputs:
    dev:
      type: clickhouse
      schema: dbt
      host: localhost
      port: 9000
      user: default
      password: "1234"
```

```bash
# Создание базы данных dbt и таблиц источника
clickhouse-client --password=1234 --query="create database dbt;"
clickhouse-client --database=dbt --password=1234 --multiquery < init_source_tables.sql
```

```bash
# dbt commands
dbt debug
dbt deps
dbt compile
dbt run
dbt docs generate
dbt docs serve --port 8090
```

```bash
# Run check queries
clickhouse-client --database=dbt --password=1234 --multiquery < check_queries.sql
```

## Проверочные запросы

```
Q2.1    12672281651     1992    MFGR#121
Q2.1    13001303186     1992    MFGR#1210
Q2.1    13805417452     1992    MFGR#1211
Q2.1    12776234014     1992    MFGR#1212
Q2.1    13433864328     1992    MFGR#1213
Q2.1    13581771711     1992    MFGR#1214
Q2.1    13053257221     1992    MFGR#1215
Q2.1    13434550494     1992    MFGR#1216
Q2.1    14000667157     1992    MFGR#1217
Q2.1    13682184743     1992    MFGR#1218
Q2.1    12490304616     1992    MFGR#1219
Q2.1    13848761978     1992    MFGR#122
Q2.1    12695654353     1992    MFGR#1220
Q2.1    13943039313     1992    MFGR#1221
Q2.1    12816003837     1992    MFGR#1222
Q2.1    12731556625     1992    MFGR#1223
Q2.1    14196465733     1992    MFGR#1224
Q2.1    13099594674     1992    MFGR#1225
Q2.1    13837724673     1992    MFGR#1226
Q2.1    12835260089     1992    MFGR#1227
Q2.1    14013848875     1992    MFGR#1228
Q2.1    12783094897     1992    MFGR#1229
Q2.1    13190480233     1992    MFGR#123
Q2.1    12758829878     1992    MFGR#1230
Q2.1    13706848098     1992    MFGR#1231
Q2.1    15111172085     1992    MFGR#1232
Q2.1    12788789701     1992    MFGR#1233
Q2.1    12886732429     1992    MFGR#1234
Q2.1    14200745630     1992    MFGR#1235
Q2.1    13699711844     1992    MFGR#1236
Q2.1    13494301997     1992    MFGR#1237
Q2.1    11955509041     1992    MFGR#1238
Q2.1    12522692893     1992    MFGR#1239
Q2.1    13128373576     1992    MFGR#124
Q2.1    13900238799     1992    MFGR#1240
Q2.1    12889269530     1992    MFGR#125
Q2.1    12072098894     1992    MFGR#126
Q2.1    13326968200     1992    MFGR#127
Q2.1    13205227869     1992    MFGR#128
Q2.1    12060639481     1992    MFGR#129
Q2.1    12913064170     1993    MFGR#121
Q2.1    12846153574     1993    MFGR#1210
Q2.1    13319472884     1993    MFGR#1211
Q2.1    12656867131     1993    MFGR#1212
Q2.1    12958664957     1993    MFGR#1213
Q2.1    12996106178     1993    MFGR#1214
Q2.1    13749400474     1993    MFGR#1215
Q2.1    13156279495     1993    MFGR#1216
Q2.1    14133397051     1993    MFGR#1217
Q2.1    13300752041     1993    MFGR#1218
Q2.1    13188526927     1993    MFGR#1219
Q2.1    13669006986     1993    MFGR#122
Q2.1    13151060231     1993    MFGR#1220
Q2.1    13520271743     1993    MFGR#1221
Q2.1    13204649517     1993    MFGR#1222
Q2.1    12611021328     1993    MFGR#1223
Q2.1    13706017203     1993    MFGR#1224
Q2.1    13193613398     1993    MFGR#1225
Q2.1    13364868408     1993    MFGR#1226
Q2.1    12526434796     1993    MFGR#1227
Q2.1    13885781315     1993    MFGR#1228
Q2.1    12645170012     1993    MFGR#1229
Q2.1    12745953219     1993    MFGR#123
Q2.1    12882547721     1993    MFGR#1230
Q2.1    13242258104     1993    MFGR#1231
Q2.1    14625381340     1993    MFGR#1232
Q2.1    13028652414     1993    MFGR#1233
Q2.1    13523711079     1993    MFGR#1234
Q2.1    13980638401     1993    MFGR#1235
Q2.1    13835021719     1993    MFGR#1236
Q2.1    13741524787     1993    MFGR#1237
Q2.1    11844760060     1993    MFGR#1238
Q2.1    12403455915     1993    MFGR#1239
Q2.1    13700145770     1993    MFGR#124
Q2.1    13728834792     1993    MFGR#1240
Q2.1    12732068011     1993    MFGR#125
Q2.1    13033573314     1993    MFGR#126
Q2.1    13878439267     1993    MFGR#127
Q2.1    13234183624     1993    MFGR#128
Q2.1    12216872884     1993    MFGR#129
Q2.1    13015507995     1994    MFGR#121
Q2.1    13415972840     1994    MFGR#1210
Q2.1    13796394107     1994    MFGR#1211
Q2.1    13066189489     1994    MFGR#1212
Q2.1    13171981606     1994    MFGR#1213
Q2.1    13014609731     1994    MFGR#1214
Q2.1    13505619415     1994    MFGR#1215
Q2.1    13154008183     1994    MFGR#1216
Q2.1    13993249029     1994    MFGR#1217
Q2.1    13447685058     1994    MFGR#1218
Q2.1    12786720187     1994    MFGR#1219
Q2.1    13686460859     1994    MFGR#122
Q2.1    12816274355     1994    MFGR#1220
Q2.1    13701914320     1994    MFGR#1221
Q2.1    12973502122     1994    MFGR#1222
Q2.1    12097673606     1994    MFGR#1223
Q2.1    14158613987     1994    MFGR#1224
Q2.1    13367339460     1994    MFGR#1225
Q2.1    13592369907     1994    MFGR#1226
Q2.1    12688300755     1994    MFGR#1227
Q2.1    13929240610     1994    MFGR#1228
Q2.1    12578247606     1994    MFGR#1229
Q2.1    12902018098     1994    MFGR#123
Q2.1    12894203129     1994    MFGR#1230
Q2.1    12881299936     1994    MFGR#1231
Q2.1    14986840428     1994    MFGR#1232
Q2.1    13258835859     1994    MFGR#1233
Q2.1    13282162516     1994    MFGR#1234
Q2.1    13523371719     1994    MFGR#1235
Q2.1    14052867150     1994    MFGR#1236
Q2.1    13824154900     1994    MFGR#1237
Q2.1    11911167126     1994    MFGR#1238
Q2.1    12650040050     1994    MFGR#1239
Q2.1    13372816683     1994    MFGR#124
Q2.1    13874852324     1994    MFGR#1240
Q2.1    13113458783     1994    MFGR#125
Q2.1    12443110357     1994    MFGR#126
Q2.1    13197254501     1994    MFGR#127
Q2.1    13561334546     1994    MFGR#128
Q2.1    12215960647     1994    MFGR#129
Q2.1    12548988553     1995    MFGR#121
Q2.1    13298369956     1995    MFGR#1210
Q2.1    13620817848     1995    MFGR#1211
Q2.1    12610662225     1995    MFGR#1212
Q2.1    13292941078     1995    MFGR#1213
Q2.1    13449826225     1995    MFGR#1214
Q2.1    13210454604     1995    MFGR#1215
Q2.1    13281112431     1995    MFGR#1216
Q2.1    13965326980     1995    MFGR#1217
Q2.1    13456838120     1995    MFGR#1218
Q2.1    12636008879     1995    MFGR#1219
Q2.1    13596382674     1995    MFGR#122
Q2.1    13263424971     1995    MFGR#1220
Q2.1    13880780596     1995    MFGR#1221
Q2.1    13067280967     1995    MFGR#1222
Q2.1    12522080131     1995    MFGR#1223
Q2.1    13648591095     1995    MFGR#1224
Q2.1    13489508329     1995    MFGR#1225
Q2.1    13692206761     1995    MFGR#1226
Q2.1    12819880503     1995    MFGR#1227
Q2.1    14290014609     1995    MFGR#1228
Q2.1    12684929098     1995    MFGR#1229
Q2.1    13107036842     1995    MFGR#123
Q2.1    12456838286     1995    MFGR#1230
Q2.1    13065298087     1995    MFGR#1231
Q2.1    14027053523     1995    MFGR#1232
Q2.1    12626335379     1995    MFGR#1233
Q2.1    12935669993     1995    MFGR#1234
Q2.1    13565017652     1995    MFGR#1235
Q2.1    13373311601     1995    MFGR#1236
Q2.1    14124141780     1995    MFGR#1237
Q2.1    11700287744     1995    MFGR#1238
Q2.1    12414542998     1995    MFGR#1239
Q2.1    13677989398     1995    MFGR#124
Q2.1    13971716794     1995    MFGR#1240
Q2.1    13193092677     1995    MFGR#125
Q2.1    12934183160     1995    MFGR#126
Q2.1    13113323851     1995    MFGR#127
Q2.1    13642471572     1995    MFGR#128
Q2.1    12284711598     1995    MFGR#129
Q2.1    12964290247     1996    MFGR#121
Q2.1    13069002816     1996    MFGR#1210
Q2.1    14394514059     1996    MFGR#1211
Q2.1    12765635985     1996    MFGR#1212
Q2.1    13152629772     1996    MFGR#1213
Q2.1    12874185514     1996    MFGR#1214
Q2.1    13724762331     1996    MFGR#1215
Q2.1    13424153649     1996    MFGR#1216
Q2.1    13945542686     1996    MFGR#1217
Q2.1    13821368995     1996    MFGR#1218
Q2.1    12646017203     1996    MFGR#1219
Q2.1    14000988039     1996    MFGR#122
Q2.1    12997436256     1996    MFGR#1220
Q2.1    13483832998     1996    MFGR#1221
Q2.1    12786027627     1996    MFGR#1222
Q2.1    12246975901     1996    MFGR#1223
Q2.1    14246722137     1996    MFGR#1224
Q2.1    13289035563     1996    MFGR#1225
Q2.1    13471416801     1996    MFGR#1226
Q2.1    12633157628     1996    MFGR#1227
Q2.1    13856331507     1996    MFGR#1228
Q2.1    12380696263     1996    MFGR#1229
Q2.1    12868757234     1996    MFGR#123
Q2.1    12584005428     1996    MFGR#1230
Q2.1    13171910923     1996    MFGR#1231
Q2.1    14770510635     1996    MFGR#1232
Q2.1    12923797345     1996    MFGR#1233
Q2.1    12893178255     1996    MFGR#1234
Q2.1    14348335024     1996    MFGR#1235
Q2.1    13657838112     1996    MFGR#1236
Q2.1    14084638477     1996    MFGR#1237
Q2.1    11883879165     1996    MFGR#1238
Q2.1    12988292013     1996    MFGR#1239
Q2.1    13662170114     1996    MFGR#124
Q2.1    14042075637     1996    MFGR#1240
Q2.1    12971867897     1996    MFGR#125
Q2.1    12691828718     1996    MFGR#126
Q2.1    13418126236     1996    MFGR#127
Q2.1    13561233656     1996    MFGR#128
Q2.1    12402579373     1996    MFGR#129
Q2.1    12623446461     1997    MFGR#121
Q2.1    13032236479     1997    MFGR#1210
Q2.1    13956119522     1997    MFGR#1211
Q2.1    12579772347     1997    MFGR#1212
Q2.1    13165240844     1997    MFGR#1213
Q2.1    13053150144     1997    MFGR#1214
Q2.1    13594352209     1997    MFGR#1215
Q2.1    13434552589     1997    MFGR#1216
Q2.1    14014730316     1997    MFGR#1217
Q2.1    13310005662     1997    MFGR#1218
Q2.1    13292211404     1997    MFGR#1219
Q2.1    13686592704     1997    MFGR#122
Q2.1    12992165647     1997    MFGR#1220
Q2.1    13493962072     1997    MFGR#1221
Q2.1    12868103937     1997    MFGR#1222
Q2.1    12336876930     1997    MFGR#1223
Q2.1    14299976456     1997    MFGR#1224
Q2.1    13318244222     1997    MFGR#1225
Q2.1    13197280677     1997    MFGR#1226
Q2.1    12673413775     1997    MFGR#1227
Q2.1    14214738649     1997    MFGR#1228
Q2.1    12636639801     1997    MFGR#1229
Q2.1    13013892507     1997    MFGR#123
Q2.1    12877479781     1997    MFGR#1230
Q2.1    13171392743     1997    MFGR#1231
Q2.1    14750894849     1997    MFGR#1232
Q2.1    12863032096     1997    MFGR#1233
Q2.1    12983888218     1997    MFGR#1234
Q2.1    13858359345     1997    MFGR#1235
Q2.1    13426990989     1997    MFGR#1236
Q2.1    14121908843     1997    MFGR#1237
Q2.1    11549152306     1997    MFGR#1238
Q2.1    12256110417     1997    MFGR#1239
Q2.1    13443891456     1997    MFGR#124
Q2.1    13676437251     1997    MFGR#1240
Q2.1    12531582164     1997    MFGR#125
Q2.1    12522657980     1997    MFGR#126
Q2.1    13585159821     1997    MFGR#127
Q2.1    13327530904     1997    MFGR#128
Q2.1    12342724100     1997    MFGR#129
Q2.1    7569438418      1998    MFGR#121
Q2.1    7792556928      1998    MFGR#1210
Q2.1    8043490596      1998    MFGR#1211
Q2.1    7196701222      1998    MFGR#1212
Q2.1    7981049903      1998    MFGR#1213
Q2.1    7605825009      1998    MFGR#1214
Q2.1    7967087557      1998    MFGR#1215
Q2.1    7543542956      1998    MFGR#1216
Q2.1    8108839661      1998    MFGR#1217
Q2.1    7637530413      1998    MFGR#1218
Q2.1    7426254540      1998    MFGR#1219
Q2.1    8134382920      1998    MFGR#122
Q2.1    7519265629      1998    MFGR#1220
Q2.1    8071181260      1998    MFGR#1221
Q2.1    7599263148      1998    MFGR#1222
Q2.1    7366631661      1998    MFGR#1223
Q2.1    8255157765      1998    MFGR#1224
Q2.1    7761197600      1998    MFGR#1225
Q2.1    8380750746      1998    MFGR#1226
Q2.1    7176752842      1998    MFGR#1227
Q2.1    8540908992      1998    MFGR#1228
Q2.1    7732826860      1998    MFGR#1229
Q2.1    7778915813      1998    MFGR#123
Q2.1    7253373114      1998    MFGR#1230
Q2.1    7615184866      1998    MFGR#1231
Q2.1    8504193275      1998    MFGR#1232
Q2.1    7649719262      1998    MFGR#1233
Q2.1    7631093646      1998    MFGR#1234
Q2.1    8094634731      1998    MFGR#1235
Q2.1    8354429462      1998    MFGR#1236
Q2.1    8119344863      1998    MFGR#1237
Q2.1    6755380305      1998    MFGR#1238
Q2.1    7397451291      1998    MFGR#1239
Q2.1    7947399165      1998    MFGR#124
Q2.1    8331229217      1998    MFGR#1240
Q2.1    7672739882      1998    MFGR#125
Q2.1    7369144299      1998    MFGR#126
Q2.1    8001904207      1998    MFGR#127
Q2.1    7461073797      1998    MFGR#128
Q2.1    6974038529      1998    MFGR#129
```

```
Q3.3    UNITED KI1      UNITED KI5      1992    1178335603
Q3.3    UNITED KI1      UNITED KI1      1992    1052597356
Q3.3    UNITED KI5      UNITED KI1      1992    1026260086
Q3.3    UNITED KI5      UNITED KI5      1992    973349994
Q3.3    UNITED KI5      UNITED KI5      1993    1083378728
Q3.3    UNITED KI5      UNITED KI1      1993    1043169947
Q3.3    UNITED KI1      UNITED KI5      1993    965639669
Q3.3    UNITED KI1      UNITED KI1      1993    918452812
Q3.3    UNITED KI5      UNITED KI5      1994    1260730803
Q3.3    UNITED KI1      UNITED KI5      1994    1081071702
Q3.3    UNITED KI1      UNITED KI1      1994    1020245194
Q3.3    UNITED KI5      UNITED KI1      1994    863514969
Q3.3    UNITED KI1      UNITED KI5      1995    1124054660
Q3.3    UNITED KI5      UNITED KI5      1995    1068365947
Q3.3    UNITED KI5      UNITED KI1      1995    1040392678
Q3.3    UNITED KI1      UNITED KI1      1995    1039336005
Q3.3    UNITED KI1      UNITED KI5      1996    1062077548
Q3.3    UNITED KI5      UNITED KI5      1996    958571109
Q3.3    UNITED KI5      UNITED KI1      1996    940597740
Q3.3    UNITED KI1      UNITED KI1      1996    874229030
Q3.3    UNITED KI1      UNITED KI5      1997    1163355766
Q3.3    UNITED KI1      UNITED KI1      1997    982350529
Q3.3    UNITED KI5      UNITED KI5      1997    949314641
Q3.3    UNITED KI5      UNITED KI1      1997    785895247
```

```
Q4.2    1997    ARGENTINA       MFGR#11 20633150130
Q4.2    1997    ARGENTINA       MFGR#12 20911142211
Q4.2    1997    ARGENTINA       MFGR#13 20751352336
Q4.2    1997    ARGENTINA       MFGR#14 20725587334
Q4.2    1997    ARGENTINA       MFGR#15 20847465627
Q4.2    1997    ARGENTINA       MFGR#21 20249876951
Q4.2    1997    ARGENTINA       MFGR#22 21302749143
Q4.2    1997    ARGENTINA       MFGR#23 20495067091
Q4.2    1997    ARGENTINA       MFGR#24 20640513738
Q4.2    1997    ARGENTINA       MFGR#25 20581166907
Q4.2    1997    BRAZIL  MFGR#11 20336534391
Q4.2    1997    BRAZIL  MFGR#12 19878221181
Q4.2    1997    BRAZIL  MFGR#13 19800437055
Q4.2    1997    BRAZIL  MFGR#14 19931925060
Q4.2    1997    BRAZIL  MFGR#15 19816491706
Q4.2    1997    BRAZIL  MFGR#21 19805847607
Q4.2    1997    BRAZIL  MFGR#22 20195348769
Q4.2    1997    BRAZIL  MFGR#23 20074204925
Q4.2    1997    BRAZIL  MFGR#24 19665389566
Q4.2    1997    BRAZIL  MFGR#25 19802289453
Q4.2    1997    CANADA  MFGR#11 20993920907
Q4.2    1997    CANADA  MFGR#12 20788212732
Q4.2    1997    CANADA  MFGR#13 20582154083
Q4.2    1997    CANADA  MFGR#14 20362070872
Q4.2    1997    CANADA  MFGR#15 21019323130
Q4.2    1997    CANADA  MFGR#21 20628385631
Q4.2    1997    CANADA  MFGR#22 21051367486
Q4.2    1997    CANADA  MFGR#23 21246059063
Q4.2    1997    CANADA  MFGR#24 20899413741
Q4.2    1997    CANADA  MFGR#25 20371722143
Q4.2    1997    PERU    MFGR#11 20123262396
Q4.2    1997    PERU    MFGR#12 20435195199
Q4.2    1997    PERU    MFGR#13 20644146457
Q4.2    1997    PERU    MFGR#14 20792194518
Q4.2    1997    PERU    MFGR#15 20257979054
Q4.2    1997    PERU    MFGR#21 20161248985
Q4.2    1997    PERU    MFGR#22 20485090615
Q4.2    1997    PERU    MFGR#23 20348873210
Q4.2    1997    PERU    MFGR#24 20678352774
Q4.2    1997    PERU    MFGR#25 20765819746
Q4.2    1997    UNITED STATES   MFGR#11 20724850604
Q4.2    1997    UNITED STATES   MFGR#12 20017511699
Q4.2    1997    UNITED STATES   MFGR#13 21016131045
Q4.2    1997    UNITED STATES   MFGR#14 20014491295
Q4.2    1997    UNITED STATES   MFGR#15 20196560991
Q4.2    1997    UNITED STATES   MFGR#21 20531748627
Q4.2    1997    UNITED STATES   MFGR#22 20882575322
Q4.2    1997    UNITED STATES   MFGR#23 21070136590
Q4.2    1997    UNITED STATES   MFGR#24 20257501400
Q4.2    1997    UNITED STATES   MFGR#25 20251954880
Q4.2    1998    ARGENTINA       MFGR#11 12288150848
Q4.2    1998    ARGENTINA       MFGR#12 12150903556
Q4.2    1998    ARGENTINA       MFGR#13 12253619754
Q4.2    1998    ARGENTINA       MFGR#14 11761221854
Q4.2    1998    ARGENTINA       MFGR#15 12044241064
Q4.2    1998    ARGENTINA       MFGR#21 12549693537
Q4.2    1998    ARGENTINA       MFGR#22 12128760181
Q4.2    1998    ARGENTINA       MFGR#23 12047927880
Q4.2    1998    ARGENTINA       MFGR#24 12335758706
Q4.2    1998    ARGENTINA       MFGR#25 11979080219
Q4.2    1998    BRAZIL  MFGR#11 11647118611
Q4.2    1998    BRAZIL  MFGR#12 11765031850
Q4.2    1998    BRAZIL  MFGR#13 11539651912
Q4.2    1998    BRAZIL  MFGR#14 11728424691
Q4.2    1998    BRAZIL  MFGR#15 12047145706
Q4.2    1998    BRAZIL  MFGR#21 11782460918
Q4.2    1998    BRAZIL  MFGR#22 11756056270
Q4.2    1998    BRAZIL  MFGR#23 11547114917
Q4.2    1998    BRAZIL  MFGR#24 12102760874
Q4.2    1998    BRAZIL  MFGR#25 12136894531
Q4.2    1998    CANADA  MFGR#11 12053393754
Q4.2    1998    CANADA  MFGR#12 12283529601
Q4.2    1998    CANADA  MFGR#13 12468524366
Q4.2    1998    CANADA  MFGR#14 12417969344
Q4.2    1998    CANADA  MFGR#15 12783220814
Q4.2    1998    CANADA  MFGR#21 11846843793
Q4.2    1998    CANADA  MFGR#22 12420965086
Q4.2    1998    CANADA  MFGR#23 11510243336
Q4.2    1998    CANADA  MFGR#24 12403564192
Q4.2    1998    CANADA  MFGR#25 12021045203
Q4.2    1998    PERU    MFGR#11 11920946766
Q4.2    1998    PERU    MFGR#12 11722265770
Q4.2    1998    PERU    MFGR#13 11830328247
Q4.2    1998    PERU    MFGR#14 12277764929
Q4.2    1998    PERU    MFGR#15 11685309770
Q4.2    1998    PERU    MFGR#21 11570486758
Q4.2    1998    PERU    MFGR#22 12064845586
Q4.2    1998    PERU    MFGR#23 12029816559
Q4.2    1998    PERU    MFGR#24 11840207053
Q4.2    1998    PERU    MFGR#25 11605382452
Q4.2    1998    UNITED STATES   MFGR#11 12111987890
Q4.2    1998    UNITED STATES   MFGR#12 12153958363
Q4.2    1998    UNITED STATES   MFGR#13 12111547473
Q4.2    1998    UNITED STATES   MFGR#14 12164432343
Q4.2    1998    UNITED STATES   MFGR#15 12163317594
Q4.2    1998    UNITED STATES   MFGR#21 11771585140
Q4.2    1998    UNITED STATES   MFGR#22 12426045879
Q4.2    1998    UNITED STATES   MFGR#23 12062197640
Q4.2    1998    UNITED STATES   MFGR#24 11953726571
Q4.2    1998    UNITED STATES   MFGR#25 12263410706
```



